
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>모두의 자율학습, MOZA</title>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap");
        .chapter-block {
            border: 1px solid #000;
            border-radius: 8px;
            padding: 20px;
            margin: 100px 20px 20px 20px; /* 챕터 추가 버튼 아래에 여백 추가 */
            text-align: center;
            font-family: Arial, sans-serif;
            cursor: pointer;
        }
        #add-button {
            display: block;
            width: 200px;
            margin: 20px auto;
            padding: 10px;
            background-color: #007BFF;
            color: white;
            text-align: center;
            border-radius: 8px;
            text-decoration: none;
            font-size: 16px;
            cursor: pointer;
            position: fixed; /* 고정 위치 설정 */
            top: 20px; /* 페이지 상단에서 20px 떨어진 위치 */
            left: 50%; /* 페이지 중앙으로 이동 */
            transform: translateX(-50%); /* 중앙 정렬 */
            z-index: 1000; /* 다른 요소들 위에 배치 */
        }
        #chapter-form {
            display: none;
            margin: 80px 20px 20px 20px; /* 챕터 추가 버튼 아래에 여백 추가 */
            padding: 20px;
            border: 1px solid #000;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        #chapter-form input{
            display: block;
            width: 80%;
            margin: 10px auto;
            padding: 10px;
            font-size: 16px;
        }
        #chapter-form button{
          display: block;
          width: 200px;
          margin: 10px auto;
          padding: 10px;
          font-size: 16px;
          background-color: #4CAF50;
          color: white;
          text-align: center;
          border-radius: 8px;
          border: transparent;
      }
    </style>
</head>
<body>
    <a id="add-button" onclick="showForm()">과목 추가</a>
    <form id="chapter-form" onsubmit="submitForm(event)">
        <input type="text" id="chapter-title" placeholder="chapter" required>
        <input type="text" id="chapter-contents" placeholder="contents" required>
        <button type="submit">Submit</button>
    </form>
    <script>
        //load
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const id = urlParams.get('id');
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch(`https://apict.pnu.app/subject/${id}/chapter`,{
                    credentials: 'include'
                });
                const data = await response.json();
                console.log(data);
                data.chapter.forEach(item => {
                    console.log(item);
                    const chapterBlock = document.createElement('div');
                    chapterBlock.className = 'chapter-block';
                    chapterBlock.innerHTML = `
                        <h2>${item.title}</h2>
                        <p>${item.content}</p>
                        <button onclick="location.href='mainQuiz.html?id=${item.id}'">문제 생성</button>
                    `;
                    document.body.appendChild(chapterBlock);
                });
            } catch (error) {
                console.error('서버와 통신하는 동안 오류가 발생했습니다:', error);
            }
        });
        
        function showForm() {
            document.getElementById('chapter-form').style.display = 'block';
        }
        
        async function submitForm(event) {
            event.preventDefault();
            const title = document.getElementById('chapter-title').value;
            const contents = document.getElementById('chapter-contents').value;
            
            const chapterBlock = document.createElement('div');
            chapterBlock.className = 'chapter-block';
            
            chapterBlock.innerHTML = `
                <h2>${title}</h2>
                <p>${contents}</p>
                <button onclick="location.href='mainQuiz.html?id=new'">문제 생성</button>
            `;
            document.body.insertBefore(chapterBlock, document.getElementById('add-button'));
            document.getElementById('chapter-form').reset();
            document.getElementById('chapter-form').style.display = 'none';
        
            try {
                const response = await fetch(`https://apict.pnu.app/subject/${id}/chapter`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        chapter : title,
                        contents : contents
                    }),
                    credentials: 'include'
                });
                const data = await response.json();
                console.log(data);
                // After successful post, update the new chapter block with the correct ID
                chapterBlock.querySelector('button').setAttribute('onclick', `location.href='mainQuiz.html?id=${data.newId}'`);
            } catch (error) {
                console.error('서버와 통신하는 동안 오류가 발생했습니다:', error);
            }
        }
        
    </script>
</body>
</html>
